import{r as d,j as e}from"./react-BA-y5DQ0.js";import{c as Ee}from"./react-dom-po7OO9u3.js";import{i as ze,g as me,a as se,o as ue,d as G,b as V,s as $e,c as je,e as ce,f as ie,h as Ae,j as Te,u as Ke}from"./@firebase-MnxZuzif.js";/* empty css                  */import"./firebase-ChVknsIU.js";import{u as le,L as ne,a as Fe,b as Le,B as Ie,R as Me,c as J,N as Be}from"./react-router-BJntWzlY.js";import{N as Z}from"./react-bootstrap-BrSsBzZw.js";import{S as ge}from"./react-signature-canvas-DMvmAK_2.js";import{W as Oe}from"./react-webcam-BZ5lNZt1.js";import"./@react-pdf-BHIduB5r.js";import{m as Re,C as We}from"./react-big-calendar-B2Dkip4a.js";import{h as de}from"./moment-DDFq35sx.js";import{r as Ue,D as Ge}from"./react-datepicker-DZSQQqdK.js";/* empty css                        */import{M as oe}from"./react-modal-Dc3fctXj.js";import{J as Ne,a5 as he}from"./date-fns-4yUWT9Ge.js";import"./scheduler-SPyfQU6S.js";import"./tslib-mnf4cu7N.js";import"./idb-BXWtuYvb.js";import"./dom-helpers-CbdCnQe0.js";import"./@babel-BVDyanKE.js";import"./classnames-DqLwlgqq.js";import"./invariant-BIx8IuoX.js";import"./react-lifecycles-compat-BzMyrFSO.js";import"./warning-D31qWzNz.js";import"./uncontrollable-CI0KGoC3.js";import"./@restart-ByvjgjHj.js";import"./prop-types-D2f4Tpnk.js";import"./signature_pad-CT7xMktM.js";import"./trim-canvas-Dmv0tWmu.js";import"./color-string-CNcAWxkL.js";import"./color-name-Dju3oUBS.js";import"./simple-swizzle-FKz8em3-.js";import"./is-arrayish-DyGeW-O8.js";import"./queue-DRR6eK-V.js";import"./inherits-BICa84dG.js";import"./events-DQ172AOg.js";import"./fontkit-BpzJXIms.js";import"./restructure-CCPsyU-B.js";import"./@swc-DIxjOVuh.js";import"./fast-deep-equal-CAZUWk_h.js";import"./unicode-properties-DnlVU5OX.js";import"./base64-js-8-fGevCI.js";import"./unicode-trie-DYuQ669R.js";import"./tiny-inflate-CIsKVSEU.js";import"./dfa-d9LVr0Fv.js";import"./clone-BPHPbKal.js";import"./brotli-C4Bi_3DI.js";import"./pako-BGesrnHF.js";import"./crypto-js-DbM4tJwW.js";import"./linebreak-B_5vJSkj.js";import"./jay-peg-CGGSUkA4.js";import"./media-engine-Bu0odexT.js";import"./hsl-to-hex-C4ZoadaU.js";import"./hsl-to-rgb-for-reals-jL61FXS_.js";import"./postcss-value-parser-ChJfAqVp.js";import"./bidi-js-Dpu9EnKw.js";import"./hyphen-Cff49j1G.js";import"./yoga-layout-D4Cy8N5L.js";import"./object-assign-DlUUOfZC.js";import"./date-arithmetic-DrY26MJF.js";import"./lodash-DyxhsjOn.js";import"./react-overlays-B0aUDvej.js";import"./@popperjs-D3RTujcg.js";import"./memoize-one-BdPwpGay.js";import"./dayjs-DRQbrcnn.js";import"./clsx-B-dksMZM.js";import"./@floating-ui-DagoW5S5.js";import"./exenv-BS7ugsZD.js";(function(){const h=document.createElement("link").relList;if(h&&h.supports&&h.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))g(r);new MutationObserver(r=>{for(const u of r)if(u.type==="childList")for(const f of u.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&g(f)}).observe(document,{childList:!0,subtree:!0});function p(r){const u={};return r.integrity&&(u.integrity=r.integrity),r.referrerPolicy&&(u.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?u.credentials="include":r.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function g(r){if(r.ep)return;r.ep=!0;const u=p(r);fetch(r.href,u)}})();const qe={apiKey:"AIzaSyBvyIoi9POgN-i_a0HkSVEJeX1NVx_6BFc",authDomain:"organizer-856c3.firebaseapp.com",projectId:"organizer-856c3",storageBucket:"organizer-856c3.appspot.com",messagingSenderId:"513480920908",appId:"1:513480920908:web:bdc67bb87a997e665289e9",measurementId:"G-3TXJTYM0BS"},ve=ze(qe),re=me(ve),q=se(ve);function Ze({role:t}){le();const[h,p]=d.useState(null),[g,r]=d.useState(!1);d.useEffect(()=>{const S=k=>{k.preventDefault(),p(k),r(!0)};return window.addEventListener("beforeinstallprompt",S),()=>{window.removeEventListener("beforeinstallprompt",S)}},[]);const u=async()=>{if(!h)return;h.prompt();const{outcome:S}=await h.userChoice;console.log(S==="accepted"?"App wurde installiert.":"Installation abgelehnt."),p(null),r(!1)},f=()=>{localStorage.removeItem("role"),sessionStorage.removeItem("role"),re.signOut().then(()=>{console.log("Benutzer wurde ausgeloggt."),window.location.href="/"}).catch(S=>{console.error("Fehler beim Logout:",S)})};return e.jsxs(Z,{className:"ms-40 fs-6 d-flex align-items-center",children:[e.jsx(Z.Item,{children:e.jsx(Z.Link,{as:ne,to:"/user-dashboard",className:"text-white",children:e.jsx("i",{className:"bi bi-house-door"})})}),e.jsx(Z.Item,{children:e.jsx(Z.Link,{as:ne,to:"/profil",className:"text-grey disabled",children:e.jsx("i",{className:"bi bi-person-circle"})})}),e.jsx(Z.Item,{children:e.jsx(Z.Link,{as:ne,to:"/settings",className:"text-grey disabled",children:e.jsx("i",{className:"bi bi-gear"})})}),e.jsx(Z.Item,{children:e.jsx(Z.Link,{className:"text-white",onClick:f,children:e.jsx("i",{className:"bi bi-box-arrow-right"})})}),e.jsx(Z.Item,{children:e.jsx(Z.Link,{as:ne,to:"/help",className:"text-grey disabled",children:e.jsx("i",{className:"bi bi-question-circle"})})}),g&&e.jsx(Z.Item,{children:e.jsx(Z.Link,{className:"text-white",onClick:u,children:e.jsx("i",{className:"bi bi-cloud-download"})})})]})}function Ve({onLogin:t=()=>{}}){const[h,p]=d.useState(""),[g,r]=d.useState(""),[u,f]=d.useState(""),[S,k]=d.useState(!1),o=le();d.useEffect(()=>{const j=localStorage.getItem("role");if(j)switch(t(j),j){case"admin":o("/dashboards/admin-dashboard");break;case"editor":o("/editor-dashboard");break;case"user":o("/user-dashboard");break;default:console.error("Unbekannte gespeicherte Rolle:",j),localStorage.removeItem("role")}},[t,o]),d.useEffect(()=>{const j=ue(re,async m=>{if(m)try{const x=G(q,"users",m.uid),E=await V(x);if(E.exists()){const I=E.data(),M=I.role?I.role.trim().toLowerCase():"";if(M)switch(t(M),M){case"admin":o("/dashboards/admin-dashboard");break;case"editor":o("/editor-dashboard");break;case"user":o("/user-dashboard");break;default:console.error("Unbekannte Rolle")}else console.error("Keine gültige Rolle gefunden.")}else console.error("Benutzerdaten nicht gefunden.")}catch(x){console.error("Fehler beim Abrufen der Benutzerdaten:",x)}});return()=>j()},[t,o]);const A=async j=>{j.preventDefault(),f(""),k(!0);try{const x=(await $e(re,h,g)).user,E=G(q,"users",x.uid),I=await V(E);if(I.exists()){const M=I.data(),L=M.role?M.role.trim().toLowerCase():"";localStorage.setItem("role",L),t(L),L==="admin"?o("/dashboards/admin-dashboard"):L==="editor"?o("/editor-dashboard"):L==="user"?o("/user-dashboard"):f("Unbekannte Rolle")}else f("Benutzerdaten nicht gefunden.")}catch(m){f("Login fehlgeschlagen: "+m.message)}k(!1)};return e.jsxs("div",{className:"w-80 h-50 p-6 bg-white rounded-xl shadow-md flex flex-col ali items-center space-y-4 border border-gray-200",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Login"}),e.jsxs("form",{className:"w-full flex flex-col space-y-4",onSubmit:A,children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-sm text-gray-600 mb-1",children:"Email"}),e.jsx("input",{type:"email",placeholder:"deine@mail.de",className:"px-4 py-2 border rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-400",value:h,autoComplete:"email",onChange:j=>p(j.target.value)})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-sm text-gray-600 mb-1",children:"Passwort"}),e.jsx("input",{type:"password",placeholder:"••••••••",className:"px-4 py-2 border rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-400",value:g,autoComplete:"current-password",onChange:j=>r(j.target.value)})]}),e.jsx("div",{className:"text-sm text-gray-400 text-right cursor-not-allowed select-none",children:"Passwort vergessen?"}),u&&e.jsx("p",{className:"text-sm text-red-500",children:u}),e.jsx("button",{type:"submit",disabled:S,className:"w-full bg-blue-600 text-white py-2 rounded-md hover:bg-blue-700 transition duration-200 disabled:opacity-50",children:S?"Wird geladen…":"Einloggen"})]})]})}const He=(t,h)=>{const p=new FormData,g=new Date().toISOString().replace(/[:.]/g,"-"),r=t.name.replace(/\s+/g,"_").replace(/\.[^/.]+$/,""),u=`${h}_${r}_${g}`;return p.append("file",t),p.append("upload_preset","nuviofleet"),p.append("folder",`nuviofleet_uploads/${h}`),p.append("public_id",u),fetch("https://api.cloudinary.com/v1_1/drrcicmfo/image/upload",{method:"POST",body:p}).then(f=>f.json()).then(f=>f.secure_url)},Je=({onScanComplete:t})=>{const[h,p]=d.useState([]),[g,r]=d.useState(null),[u,f]=d.useState(null),[S,k]=d.useState(!1),[o,A]=d.useState(null),j=d.useRef(null),m=async i=>{const _=Array.from(i.target.files).slice(0,4),F=[];for(const s of _){const n=await x(s);F.push(n)}p(F),I(F)},x=i=>new Promise((_,F)=>{const s=new FileReader;s.onload=()=>_(s.result),s.onerror=F,s.readAsDataURL(i)}),E=()=>{const i=j.current.getScreenshot();p([i]),I([i])},I=async i=>{k(!0),A(null),r(null);try{let _="";for(const s of i){const n=await M(s);_+=`
`+n}const F=L(_);f(F.mrz),r(F),t(F)}catch(_){A("Scan-Fehler: "+_.message)}k(!1)},M=async i=>{var c,b;const _="AIzaSyCUqEi1z8gMIQauD7Xk00HqAA-B0e3rq7w".trim(),F={requests:[{image:{content:i.split(",")[1]},features:[{type:"DOCUMENT_TEXT_DETECTION"}]}]},n=await(await fetch(`https://vision.googleapis.com/v1/images:annotate?key=${_}`,{method:"POST",body:JSON.stringify(F),headers:{"Content-Type":"application/json"}})).json();if(n.error)throw new Error(n.error.message);return((b=(c=n.responses[0])==null?void 0:c.fullTextAnnotation)==null?void 0:b.text)||""},L=i=>{const _=i.replace(/[|•°]/g,"").replace(/[^\x20-\x7EÄÖÜäöüß\n\r]/g,"").replace(/\s{2,}/g," ").trim(),F=N=>N==null?void 0:N.replace(/O/g,"0").replace(/I/g,"1").replace(/</g," ").trim(),s=(N,C="auto",$=null)=>{if(!N)return null;const v=N.match(/(\d{2})(\d{2})(\d{2})/);if(!v)return null;const[a,l,P,T]=v,K=parseInt(l);let R;return C==="birth"?R=K<30?"20"+l:"19"+l:C==="expiry"&&$?R=K<30||K<$-1900?"20"+l:"19"+l:R=K<30?"20"+l:"19"+l,`${R}-${P}-${T}`},n=(N,C,$)=>{const v=/^[A-Z0-9<]{25,36}$/;return[N,C,$].every(a=>v.test(a))},c=N=>{var $;const C=N.map(v=>v.replace(/ /g,"").trim());for(let v=0;v<C.length-2;v++){const[a,l,P]=[C[v],C[v+1],C[v+2]];if(n(a,l,P)){const T=a.slice(5,14).replace(/</g,""),K=l.slice(0,6),R=s(K,"birth"),Y=l.charAt(6),ee=l.charAt(7),Se=ee==="M"?"M":ee==="F"?"F":"X",ke=l.slice(8,14),we=s(ke,"expiry",parseInt(R==null?void 0:R.slice(0,4))),Pe=l.charAt(14),_e=l.slice(15,18).replace(/</g," ").trim(),De=l.charAt(29),pe=P.split("<<"),Ce=($=pe[0])==null?void 0:$.trim();return{first_name:(pe[1]||"").replace(/</g," ").trim(),last_name:Ce,document_number:T,birth_date:R,birth_date_check:Y,expiry_date:we,expiry_date_check:Pe,gender:Se,nationality:_e,composite_check_digit:De,raw:`${a}
${l}
${P}`}}}return{}},b=i.split(/\n|\r/).map(N=>N.trim()).filter(Boolean),D=c(b),y=(N,C=null)=>{const $=new RegExp(`${N}[\\s:]*([A-ZÄÖÜa-zäöüß0-9\\-/]+)`,"i"),v=_.match($);return v?F(v[1]):C},B=()=>{const N=i.split(/[\n\r]/).map(v=>v.trim()),C=N.findIndex(v=>/BEHÖRDE\s*\/\s*AUTHORITY\s*\/\s*AUTORIT[ÉE]/i.test(v));if(C===-1||C+1>=N.length)return null;const $=N[C+1].match(/[A-ZÄÖÜ]{3,}(?:\s+[A-ZÄÖÜ]{3,})*/);return $?$[0].toLowerCase().replace(/\b\w/g,v=>v.toUpperCase()):null},z=()=>{const N=_.split(/\n|\r/).map(K=>K.trim()),C=N.findIndex(K=>/ANSCHRIFT|ADDRESS|ADRESSE/i.test(K));if(C===-1||C+2>=N.length)return null;const $=N[C+1].match(/(\d{5})\s+([A-ZÄÖÜ\s]{2,})/),v=N[C+2].match(/([A-ZÄÖÜ\s]{2,})\s?(\d{1,4}[A-Z]?)?/);if(!$||!v)return null;const a=$[1],l=$[2].toLowerCase().replace(/\b\w/g,K=>K.toUpperCase()),P=O(w(v[1])),T=v[2]||null;return{plz:a,stadt:l,strasse:P,hausnummer:T}},w=N=>N.replace(/STRABE/gi,"Straße").replace(/STRASSE/gi,"Straße").replace(/GROB/gi,"Groß").replace(/SCHLOB/gi,"Schloß").replace(/FUB/gi,"Fuß"),O=N=>N.toLowerCase().replace(/\b\w/g,C=>C.toUpperCase()).replace(/Strasse/g,"Straße").replace(/StraßE/g,"Straße").replace(/Strasse$/i,"Straße").replace(/Straße$/i,"Straße"),W=()=>{const N=_.split(/\n|\r/).map($=>$.trim()),C=N.findIndex($=>/GEBURTSORT\s*\/\s*PLACE OF BIRTH/i.test($));if(C!==-1&&C+1<N.length){const $=N[C+1].match(/[A-ZÄÖÜß\s-]{3,}/);if($)return $[0].toLowerCase().replace(/\b\w/g,v=>v.toUpperCase())}return null},H=()=>{const N=_.split(/\n|\r/).map(v=>v.trim()),C=N.findIndex(v=>/DATUM\s*\/\s*DATE\s*\/\s*DATE/i.test(v));if(C!==-1&&C+1<N.length){const a=N[C+1].match(/(\d{2})[.\-\/](\d{2})[.\-\/](\d{2,4})/);if(a){let[l,P,T,K]=a;K.length===2&&(K=parseInt(K)<30?"20"+K:"19"+K);const R=`${K}-${T}-${P}`;if(!isNaN(Date.parse(R)))return R}}const $=_.match(/(?:Datum\s*\/\s*Date\s*\/\s*Date)[^\d]*(\d{2}[.\-\/]\d{2}[.\-\/]\d{2,4})/i);if($){const v=$[1].split(/[.\-\/]/);if(v.length===3){let[a,l,P]=v;P.length===2&&(P=parseInt(P)<30?"20"+P:"19"+P);const T=`${P}-${l}-${a}`;if(!isNaN(Date.parse(T)))return T}}return null},U=N=>{if(!N||!N.includes("-"))return N;const[C,$,v]=N.split("-");return`${v}-${$}-${C}`},ae=()=>{const N=_.match(/(?:^|\n)\s*5[.: \t-]*([A-Z0-9]{5,})/im);return N?N[1].trim():null},te=()=>{const N=_.match(/(?:^|\n)\s*9[.: \t-]*([A-Z0-9\/\s,]+)(?:\n|$)/im);if(!N)return null;const C=["B","BE","C","CE"],$=N[1].replace(/[, ]+/g,"/").replace(/\/+$/,"").split("/").map(v=>v.trim().toUpperCase()).filter(v=>C.includes(v));return $.length?$.join("/"):null},Q=N=>{const C=new RegExp(`\\b${N.replace(".","\\.?")}\\s*[.:\\s-]*\\s*(\\d{2}[.\\-/]\\d{2}[.\\-/]\\d{2,4})`,"i"),$=_.match(C);if($){let[v,a,l]=$[1].split(/[.\-\/]/);return l.length===2&&(l=parseInt(l,10)<50?"20"+l:"19"+l),`${v}-${a}-${l}`}return null},X=()=>{const N=/\b4c\s*[.:,\-\s]*([\s\S]{3,60}?)(?:\n\d|\n{2,}|$)/i,C=_.match(N);if(C){let $=C[1].replace(/-\s*\n\s*/g,"").replace(/\n/g," ").replace(/\s{2,}/g," ").trim();const v=$.split(" ");return v.length?v[v.length-1]:$}return null};return{first_name:O(D.first_name||y("Vorname")),last_name:O(D.last_name||y("Name")),birth_date:U(D.birth_date||y("Geburtsdatum")),birth_place:W()||y("Geburtsort")||null,document_number:D.document_number||y("Ausweisnummer"),issuing_date:U(H()),expiry_date:U(D.expiry_date||y("Gültig bis")),issuing_authority:B()||y("Behörde")||y("Authority")||y("Autorite")||y("Ausgestellt in"),nationality:D.nationality||null,address:z()||null,license_number:ae(),license_classes:te(),license_issuing_date:Q("4a"),license_expiry_date:Q("4b"),license_authority:X()}};return e.jsxs("div",{className:"p-3 border rounded",children:[e.jsx("h5",{children:"📷 Dokumenten-Scanner"}),e.jsxs("div",{className:"row g-2",children:[e.jsxs("div",{className:"col-12 col-md-6",children:[e.jsx("label",{className:"form-label",children:"Bild hochladen"}),e.jsx("input",{type:"file",accept:"image/*",multiple:!0,onChange:m,className:"form-control mb-2"})]}),e.jsxs("div",{className:"col-12 col-md-6 d-flex flex-column align-items-center",children:[e.jsx("label",{className:"form-label",children:"Webcam"}),e.jsx(Oe,{ref:j,screenshotFormat:"image/jpeg",className:"w-100 mb-2",videoConstraints:{facingMode:"environment"},style:{maxWidth:320,borderRadius:8,border:"1px solid #ccc"}}),e.jsx("button",{className:"btn btn-success w-100 mb-2",onClick:E,type:"button",children:"📸 Scannen (Webcam)"})]})]}),S&&e.jsx("div",{className:"alert alert-info mt-2",children:"⏳ Scan läuft..."}),o&&e.jsx("div",{className:"alert alert-danger mt-2",children:o}),h.length>0&&e.jsx("div",{className:"row mt-2",children:h.map((i,_)=>e.jsx("div",{className:"col-6 col-md-4 mb-2",children:e.jsx("img",{src:i,alt:`Vorschau ${_+1}`,className:"img-thumbnail",style:{width:"100%",maxHeight:180,objectFit:"contain"}})},_))}),u&&e.jsxs("div",{className:"bg-dark text-light p-2 mt-3 rounded",children:[e.jsx("h6",{className:"text-warning",children:"Maschinenlesbare Zone (MRZ):"}),e.jsx("pre",{style:{whiteSpace:"pre-line"},children:u.replace(/\\n/g,`
`)})]}),g&&e.jsx("pre",{className:"bg-light p-2 mt-3 rounded border",children:JSON.stringify({...g,mrz:g.mrz?g.mrz.replace(/\n/g,`
`):void 0},null,2)})]})},Xe=()=>{var C,$,v;const[t,h]=d.useState({name:"",vorname:"",telNr:"",vertragsnummer:"",strasse:"",hausnummer:"",plz:"",Stadt:"",personalausweisnr:"",ausgestellt_in:"",ausgestellt_am:"",geburtsdatum:"",geburtsort:"",fuehrerscheinnr:"",fuehrerscheinklasse:"",fsausgestellt_in:"",fsausgestellt_am:"",fsgueltig_bis:"",schaden:"",ladebordwand:!1,fahrtenschreiber:!1,tankvoll:!1,uebergabe_datum:"",uebergabe_zeit:"",uebergabe_ort:"",rueckgabe_datum:"",rueckgabe_zeit:"",rueckgabe_ort:""}),[p,g]=d.useState(!1),[r,u]=d.useState([]),[f,S]=d.useState({}),[k,o]=d.useState([]),[A,j]=d.useState(!1),[m,x]=d.useState(null),E=d.useRef(null),I=d.useRef(null),M=d.useRef(null),[L,i]=d.useState({mieter:"",vermieter:""}),_=Fe(),F=((C=_.state)==null?void 0:C.uid)||"Keine UID übergeben",s=($=_.state)==null?void 0:$.eventData;d.useEffect(()=>{(async()=>{if(F!=="Keine UID übergeben"){const l=G(q,"events",F),P=await V(l);P.exists()&&h(T=>({...T,...P.data()}))}})()},[F]),d.useEffect(()=>{s&&h(a=>({...a,name:s.name||a.name,vorname:s.vorname||a.vorname,telNr:s.telNr||a.telNr,strasse:s.strasse||a.strasse,hausnummer:s.hausnummer||a.hausnummer,plz:s.plz||a.plz,Stadt:s.Stadt||a.Stadt,uebergabe_datum:s.start?new Date(s.start).toISOString().slice(0,10):a.uebergabe_datum,uebergabe_zeit:s.start?new Date(s.start).toISOString().slice(11,16):a.uebergabe_zeit,rueckgabe_datum:s.end?new Date(s.end).toISOString().slice(0,10):a.rueckgabe_datum,rueckgabe_zeit:s.end?new Date(s.end).toISOString().slice(11,16):a.rueckgabe_zeit}))},[s]);const n=a=>{const{name:l,value:P,type:T,checked:K}=a.target,R=T==="checkbox"?K:P;if(h({...t,[l]:R}),l==="personalausweisnr"){const Y=/^[A-Z0-9]{9}$/i.test(P);S(ee=>({...ee,personalausweisnr:Y?"":"Bitte 9 Buchstaben/Ziffern eingeben (z. B. L01X00T42)"}))}if(l==="fuehrerscheinnr"){const Y=/^[A-Z]{1}[0-9]{8,9}$/i.test(P);S(ee=>({...ee,fuehrerscheinnr:Y?"":"Ungültiges Format: z. B. B12345678"}))}},c=async a=>{a.preventDefault();const l=F,P=L.mieter,T=L.vermieter;try{await je(G(q,"vertraege",l),{...t,unterschriftKunde:P,unterschriftVermieter:T,schadenbilder:r,marker:k,erstelltAm:new Date}),alert("Vertrag gespeichert!")}catch(K){alert("Fehler beim Speichern: "+K.message)}},b=a=>{const l=E.current.getBoundingClientRect(),P=(a.clientX-l.left)/l.width*100,T=(a.clientY-l.top)/l.height*100;x({x:P,y:T,type:"",note:""}),j(!0)},D=(a,l)=>{let P="gray";a==="Kratzer"?P="blue":a==="Beule"?P="red":a==="Lack"?P="orange":a==="Glasbruch"&&(P="black"),o(T=>[...T,{...m,type:a,note:l,color:P}]),j(!1),x(null)},y=a=>{o(l=>l.filter((P,T)=>T!==a))},B=async a=>{const l=Array.from(a.target.files).slice(0,5-r.length),P=await Promise.all(l.map(async T=>await He(T,s==null?void 0:s.fahrzeug)));u(T=>[...T,...P].slice(0,5))},[z,w]=d.useState(null),[O,W]=d.useState(!1),[H,U]=d.useState({score:0,seite:"unbekannt"}),ae=a=>{console.log("→ erhaltene Scandaten:",a),w(a),W(!0);const l=Object.values(a).filter(K=>K&&K!=="null"&&K!=="").length,P=Math.round(l/Object.keys(a).length*100),T=(a.address,"");U({score:P,seite:T})},te=a=>{const l=N(a);if(!l||!l.includes("-"))return l;const[P,T,K]=l.split("-");return`${K}-${T}-${P}`},Q=()=>{z&&(h(a=>{var l,P,T,K;return{...a,name:z.last_name||a.name,vorname:z.first_name||a.vorname,geburtsdatum:te(z.birth_date)||a.geburtsdatum,geburtsort:z.birth_place||a.geburtsort,personalausweisnr:z.document_number||a.personalausweisnr,ausgestellt_in:z.issuing_authority||a.ausgestellt_in,ausgestellt_am:te(z.issuing_date)||a.ausgestellt_am,fuehrerscheinnr:z.license_number||a.fuehrerscheinnr,fuehrerscheinklasse:z.license_classes||a.fuehrerscheinklasse,fsausgestellt_am:z.license_issuing_date||a.fsausgestellt_am,fsausgestellt_in:z.license_authority||a.fsausgestellt_in,fsgueltig_bis:z.license_expiry_date||a.fsgueltig_bis,strasse:((l=z.address)==null?void 0:l.strasse)||z.strasse||a.strasse,hausnummer:((P=z.address)==null?void 0:P.hausnummer)||z.hausnummer||a.hausnummer,plz:((T=z.address)==null?void 0:T.plz)||z.plz||a.plz,Stadt:((K=z.address)==null?void 0:K.stadt)||z.stadt||a.Stadt}}),w(null))},X=()=>{W(!1),w(null),U({score:0,seite:"unbekannt"})},N=a=>{if(!a||a.startsWith("issuing"))return"";if(/^\d{4}-\d{2}-\d{2}$/.test(a)&&!isNaN(Date.parse(a)))return a;const l=a.match(/(\d{2})[.\-\/](\d{2})[.\-\/](\d{2,4})/);if(!l)return a;let[P,T,K,R]=l;R.length===2&&(R=parseInt(R)<30?"20"+R:"19"+R);const Y=`${R}-${K}-${T}`;return!isNaN(Date.parse(Y))?Y:a};return e.jsxs(e.Fragment,{children:[e.jsx("form",{onSubmit:c,children:e.jsxs("div",{id:"vertrag-wrapper",className:"row",style:{paddingLeft:"20px",paddingRight:"20px",paddingTop:"110px",paddingBottom:"70px",minHeight:"100vh",boxSizing:"border-box",overflow:"auto"},children:[e.jsxs("div",{className:"col-6 bg-light p-4 rounded border ",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e.jsx("h4",{className:"mb-0",children:"Kundendaten:"}),e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx("span",{className:"fw-semibold",children:"Vertrag-ID:"}),e.jsx("input",{type:"text",className:"form-control form-control-sm",style:{width:"170px"},value:F,readOnly:!0})]})]}),e.jsxs("div",{className:"row align-items-end",children:[e.jsxs("div",{className:"col-4",children:[e.jsx("label",{className:"form-label",children:"Name"}),e.jsx("input",{type:"text",className:"form-control",name:"name",value:t.name,onChange:n,required:!0})]}),e.jsxs("div",{className:"col-4",children:[e.jsx("label",{className:"form-label",children:"Vorname"}),e.jsx("input",{type:"text",className:"form-control",name:"vorname",value:t.vorname,onChange:n,required:!0})]}),e.jsxs("div",{className:"col-4 gap-3 d-flex",children:[e.jsx("button",{id:"vertrag_kunde_suchen",className:"btn btn-primary btn-sm",type:"button",disabled:!0,children:e.jsx("i",{className:"bi bi-person"})}),e.jsx("button",{id:"vertrag_kunde_hinzufuegen",className:"btn btn-primary btn-sm ",type:"button",disabled:!0,children:e.jsx("i",{className:"bi bi-plus"})}),e.jsx("button",{type:"button",className:"btn btn-primary btn-sm ",onClick:()=>g(!0),children:e.jsx("i",{className:"bi bi-camera"})})]})]}),e.jsx("div",{className:"row mt-2",children:e.jsxs("div",{className:"col-10",children:[e.jsx("label",{className:"form-label",children:"Telefon"}),e.jsx("input",{type:"number",className:`form-control ${f.telNr?"is-invalid":""}`,name:"telNr",value:t.telNr,onChange:n,required:!0})]})}),e.jsxs("div",{className:"row mt-2",children:[e.jsxs("div",{className:"col-10",children:[e.jsx("label",{className:"form-label",children:"Straße"}),e.jsx("input",{type:"text",className:"form-control",name:"strasse",value:t.strasse,onChange:n,required:!0})]}),e.jsxs("div",{className:"col-2",children:[e.jsx("label",{className:"form-label",children:"Haus-Nr."}),e.jsx("input",{type:"text",className:"form-control",name:"hausnummer",value:t.hausnummer,onChange:n,required:!0})]})]}),e.jsxs("div",{className:"row mt-2",children:[e.jsxs("div",{className:"col-3",children:[e.jsx("label",{className:"form-label",children:"PLZ"}),e.jsx("input",{type:"text",className:"form-control",name:"plz",value:t.plz,onChange:n,required:!0})]}),e.jsxs("div",{className:"col-6",children:[e.jsx("label",{className:"form-label",children:"Stadt"}),e.jsx("input",{type:"text",className:"form-control",name:"Stadt",value:t.Stadt,onChange:n,required:!0})]})]}),e.jsxs("div",{className:"row mt-2",children:[e.jsxs("div",{className:"col-4",children:[e.jsx("label",{className:"form-label fw-bold",children:"Personalausweis-Nr."}),e.jsx("input",{type:"text",className:`form-control ${f.personalausweisnr?"is-invalid":""}`,name:"personalausweisnr",value:t.personalausweisnr,onChange:n,required:!0}),f.personalausweisnr&&e.jsx("div",{className:"invalid-feedback",children:f.personalausweisnr})]}),e.jsxs("div",{className:"col-4",children:[e.jsx("label",{className:"form-label",children:"Ausgestellt in"}),e.jsx("input",{type:"text",className:"form-control",name:"ausgestellt_in",value:t.ausgestellt_in,onChange:n,required:!0})]}),e.jsxs("div",{className:"col-4",children:[e.jsx("label",{className:"form-label",children:"Ausgestellt am"}),e.jsx("input",{type:"text",className:"form-control",name:"ausgestellt_am",value:t.ausgestellt_am,onChange:n,required:!0})]})]}),e.jsxs("div",{className:"row mt-2",children:[e.jsxs("div",{className:"col-6",children:[e.jsx("label",{className:"form-label",children:"Geboren am"}),e.jsx("input",{type:"text",className:"form-control",name:"geburtsdatum",value:t.geburtsdatum,onChange:n,required:!0})]}),e.jsxs("div",{className:"col-6",children:[e.jsx("label",{className:"form-label",children:"Geboren in"}),e.jsx("input",{type:"text",className:"form-control",name:"geburtsort",value:t.geburtsort,onChange:n,required:!0})]})]}),e.jsxs("div",{className:"row mt-2",children:[e.jsxs("div",{className:"col-4",children:[e.jsx("label",{className:"form-label fw-bold",children:"Führerschein-Nr."}),e.jsx("input",{type:"text",className:`form-control ${f.fuehrerscheinnr?"is-invalid":""}`,name:"fuehrerscheinnr",value:t.fuehrerscheinnr||"",onChange:n,required:!0}),f.fuehrerscheinnr&&e.jsx("div",{className:"invalid-feedback",children:f.fuehrerscheinnr})]}),e.jsxs("div",{className:"col-2",children:[e.jsx("label",{className:"form-label",children:"Klasse/n"}),e.jsx("input",{type:"text",className:"form-control",name:"fuehrerscheinklasse",value:t.fuehrerscheinklasse,onChange:n,required:!0,style:{width:`${Math.max(10,t.fuehrerscheinklasse.length+1)}ch`,minWidth:"60px",maxWidth:"100%"}})]}),e.jsxs("div",{className:"row mt-2",children:[e.jsxs("div",{className:"col-4",children:[e.jsx("label",{className:"form-label",children:"ausgestellt am"}),e.jsx("input",{type:"text",className:"form-control",name:"fsausgestellt_am",value:t.fsausgestellt_am,onChange:n,required:!0})]}),e.jsxs("div",{className:"col-4",children:[e.jsx("label",{className:"form-label",children:"ausgestellt in"}),e.jsx("input",{type:"text",className:"form-control",name:"fsausgestellt_in",value:t.fsausgestellt_in,onChange:n,required:!0})]}),e.jsxs("div",{className:"col-4",children:[e.jsx("label",{className:"form-label",children:"gültig bis"}),e.jsx("input",{type:"text",className:"form-control",name:"fsgueltig_bis",value:t.fsgueltig_bis,onChange:n,required:!0})]})]})]})]}),e.jsxs("div",{className:"col-6 d-flex flex-column justify-content-top rounded border",children:[e.jsx("small",{className:"text-center mb-2",children:"Klicke auf das Fahrzeugbild, um einen Schaden zu markieren. Klicke auf einen Marker, um ihn zu entfernen."}),e.jsx("div",{className:"mt-0",children:e.jsxs("ul",{className:"list-unstyled d-flex gap-4 mt-0 mb-1 justify-content-center",children:[e.jsx("strong",{children:"Legende:"}),e.jsxs("li",{className:"d-flex align-items-center gap-1",children:[e.jsx("span",{style:{color:"red"},children:"●"})," Beule"]}),e.jsxs("li",{className:"d-flex align-items-center gap-1",children:[e.jsx("span",{style:{color:"blue"},children:"●"})," Kratzer"]}),e.jsxs("li",{className:"d-flex align-items-center gap-1",children:[e.jsx("span",{style:{color:"orange"},children:"●"})," Lack"]}),e.jsxs("li",{className:"d-flex align-items-center gap-1",children:[e.jsx("span",{style:{color:"black"},children:"●"})," Glasbruch"]})]})}),e.jsx("div",{className:"text-center",children:e.jsxs("div",{ref:E,onClick:b,style:{position:"relative",width:"100%",height:"200px",cursor:"crosshair",background:"#f8f9fa",borderRadius:"8px",border:"1px solid #ddd",overflow:"hidden"},children:[e.jsx("img",{src:"ford.png",alt:"Fahrzeug",style:{width:"100%",height:"100%",objectFit:"contain"}}),k.map((a,l)=>e.jsx("div",{onClick:P=>{P.stopPropagation(),y(l)},title:`${a.type}: ${a.note}`,style:{position:"absolute",top:`${a.y}%`,left:`${a.x}%`,transform:"translate(-50%, -50%)",color:a.color,fontSize:"24px",fontWeight:"bold",pointerEvents:"auto",userSelect:"none",cursor:"pointer"},children:"●"},l))]})}),e.jsx("div",{className:"row mt-3",children:e.jsxs("div",{className:"col-12",children:[e.jsx("label",{className:"form-label",children:"Schadenbilder hochladen (max. 5)"}),e.jsx("input",{type:"file",accept:"image/*",multiple:!0,onChange:B,className:"form-control"})]})}),e.jsx("div",{className:"row mt-2",children:r.map((a,l)=>e.jsx("div",{className:"col-4 col-md-3 col-lg-2 mb-2",children:e.jsx("img",{src:a,alt:`Schadenbild ${l+1}`,className:"img-fluid rounded border",style:{objectFit:"cover",height:"100px",width:"100%"}})},l))}),e.jsx("div",{className:"row mt-3",children:e.jsxs("div",{className:"col",children:[e.jsxs("div",{className:"form-check form-check-inline",children:[e.jsx("input",{className:"form-check-input",type:"checkbox",id:"ladebordwand",name:"ladebordwand",checked:t.ladebordwand,onChange:n}),e.jsx("label",{className:"form-check-label",htmlFor:"ladebordwand",children:"Ladebordwand erklärt"})]}),e.jsxs("div",{className:"form-check form-check-inline",children:[e.jsx("input",{className:"form-check-input",type:"checkbox",id:"fahrtenschreiber",name:"fahrtenschreiber",checked:t.fahrtenschreiber,onChange:n}),e.jsx("label",{className:"form-check-label",htmlFor:"fahrtenschreiber",children:"Fahrtenschreiber erklärt"})]}),e.jsxs("div",{className:"form-check form-check-inline",children:[e.jsx("input",{className:"form-check-input",type:"checkbox",id:"tankvoll",name:"tankvoll",checked:t.tankvoll,onChange:n}),e.jsx("label",{className:"form-check-label",htmlFor:"tankvoll",children:"Tank voll"})]})]})}),e.jsxs("div",{className:"row mt-3",children:[e.jsxs("div",{className:"col-6",children:[e.jsx("label",{className:"form-label",children:"Fahrzeugübergabe: Datum & Zeit / Ort"}),e.jsxs("div",{className:"input-group",children:[e.jsx("input",{type:"date",className:"form-control",name:"uebergabe_datum",value:t.uebergabe_datum||"",onChange:n,required:!0}),e.jsx("input",{type:"time",className:"form-control",name:"uebergabe_zeit",value:t.uebergabe_zeit||"",onChange:n,required:!0}),e.jsx("input",{type:"text",className:"form-control",placeholder:"Ort",name:"uebergabe_ort",value:t.uebergabe_ort||"",onChange:n,required:!0})]})]}),e.jsxs("div",{className:"col-6",children:[e.jsx("label",{className:"form-label",children:"Vereinbarte Rückgabe: Datum & Zeit / Ort"}),e.jsxs("div",{className:"input-group",children:[e.jsx("input",{type:"date",className:"form-control",name:"rueckgabe_datum",value:t.rueckgabe_datum||"",onChange:n,required:!0}),e.jsx("input",{type:"time",className:"form-control",name:"rueckgabe_zeit",value:t.rueckgabe_zeit||"",onChange:n,required:!0}),e.jsx("input",{type:"text",className:"form-control",placeholder:"Ort",name:"rueckgabe_ort",value:t.rueckgabe_ort||"",onChange:n,required:!0})]})]})]}),s&&e.jsxs("div",{className:"row mt-4",children:[e.jsx("div",{className:"col-3",children:e.jsxs("div",{className:"border rounded p-2 h-100",children:[e.jsx("strong",{children:"Fahrzeug:"}),e.jsx("br",{}),s.fahrzeug||"—"]})}),e.jsx("div",{className:"col-3",children:e.jsxs("div",{className:"border rounded p-2 h-100",children:[e.jsx("strong",{children:"Zusatz:"}),e.jsx("br",{}),((v=s.zusatzOptionen)==null?void 0:v.join(", "))||"—"]})}),e.jsx("div",{className:"col-3",children:e.jsxs("div",{className:"border rounded p-2 h-100",children:[e.jsx("strong",{children:"Zusatz-Kilometer:"}),e.jsx("br",{}),s.zusatzKm||0," km"]})}),e.jsx("div",{className:"col-3",children:e.jsxs("div",{className:"border rounded p-2 h-100",children:[e.jsx("strong",{children:"Preis/KM gesamt:"}),e.jsx("br",{}),s.preis?`${s.preis} €`:"—","/",s.km?`${s.km} km`:"—"]})})]}),e.jsxs("div",{className:"row mt-3 g-3 align-items-stretch",children:[e.jsx("h6",{children:"Unterschriften"}),e.jsxs("div",{className:"col-12 col-md-6 d-flex flex-column",style:{minWidth:0},children:[e.jsx("h5",{children:"Mieter(in)"}),e.jsx(ge,{penColor:"black",canvasProps:{width:500,height:150,className:"border rounded w-100",style:{width:"100%",height:"150px"}},ref:I,onEnd:()=>i(a=>{var l;return{...a,mieter:(l=I.current)==null?void 0:l.toDataURL()}})}),e.jsx("button",{id:"vertrag_unterschrift_mieter_loeschen",type:"button",className:"btn btn-sm btn-outline-danger mt-2",onClick:()=>{I.current.clear(),i(a=>({...a,mieter:""}))},children:"Löschen"})]}),e.jsxs("div",{className:"col-12 col-md-6 d-flex flex-column",style:{minWidth:0},children:[e.jsx("h5",{children:"Vermieter(in)"}),e.jsx(ge,{penColor:"black",canvasProps:{width:500,height:150,className:"border rounded w-100",style:{width:"100%",height:"150px"}},ref:M,onEnd:()=>i(a=>{var l;return{...a,vermieter:(l=M.current)==null?void 0:l.toDataURL()}})}),e.jsx("button",{id:"vertrag_unterschrift_vermieter_loeschen",type:"button",className:"btn btn-sm btn-outline-danger mt-2",onClick:()=>{M.current.clear(),i(a=>({...a,vermieter:""}))},children:"Löschen"})]})]})]})]})}),A&&e.jsx("div",{className:"modal d-block",style:{backgroundColor:"rgba(0,0,0,0.5)"},children:e.jsx("div",{className:"modal-dialog",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h5",{className:"modal-title",children:"Schaden hinzufügen"}),e.jsx("button",{type:"button",className:"btn-close",onClick:()=>j(!1)})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Schadensart"}),e.jsxs("select",{className:"form-select",value:(m==null?void 0:m.type)||"",onChange:a=>x(l=>({...l,type:a.target.value})),children:[e.jsx("option",{value:"",children:"Wählen..."}),e.jsx("option",{value:"Beule",children:"Beule"}),e.jsx("option",{value:"Kratzer",children:"Kratzer"}),e.jsx("option",{value:"Lack",children:"Lack"}),e.jsx("option",{value:"Glasbruch",children:"Glasbruch"})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Notiz"}),e.jsx("input",{type:"text",className:"form-control",value:(m==null?void 0:m.note)||"",onChange:a=>x(l=>({...l,note:a.target.value}))})]})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>j(!1),children:"Abbrechen"}),e.jsx("button",{className:"btn btn-primary",disabled:!(m!=null&&m.type),onClick:()=>D(m.type,m.note),children:"Speichern"})]})]})})}),p&&e.jsx("div",{className:"modal d-block",tabIndex:"-1",style:{backgroundColor:"rgba(0,0,0,0.5)"},children:e.jsx("div",{className:"modal-dialog modal-lg modal-dialog-centered",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h5",{className:"modal-title",children:"📷 Dokument scannen"}),e.jsx("button",{type:"button",className:"btn-close",onClick:()=>g(!1)})]}),e.jsx("div",{className:"modal-body",children:e.jsx(Je,{onScanComplete:a=>{ae(a),g(!1)}})})]})})}),O&&e.jsx("div",{className:"modal d-block",tabIndex:"-1",style:{backgroundColor:"rgba(0,0,0,0.5)"},children:e.jsx("div",{className:"modal-dialog modal-dialog-centered",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("h5",{className:"modal-title",children:["🔍 Vorschau der erkannten Daten (",H.seite,")"]}),e.jsx("button",{type:"button",className:"btn-close",onClick:X})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("p",{className:"mb-2",children:["📈 Erkennungsrate: ",e.jsxs("strong",{children:[H.score,"%"]})," ",H.score<50&&e.jsx("span",{className:"text-danger",children:"⚠️ Qualität zu niedrig – Bild erneut scannen empfohlen"})]}),e.jsx("pre",{className:"bg-light p-2 border rounded",children:JSON.stringify(z,null,2)})]}),e.jsxs("div",{className:"modal-footer d-flex gap-2",children:[e.jsx("button",{className:"btn btn-success",onClick:()=>{Q(),setTimeout(X,10)},children:"✅ Übernehmen & ins Formular einfügen"}),e.jsx("button",{className:"btn btn-danger",onClick:X,children:"❌ Verwerfen"})]})]})})})]})};function Ye(){return e.jsx("div",{children:e.jsx("h1",{children:"Admin Dashboard"})})}function Qe(){return e.jsx("div",{children:e.jsx("h1",{children:"Editor Dashboard"})})}const et=async(t,h,p)=>{try{return(await ce(ie(q,"events"))).docs.map(u=>({id:u.id,...u.data()})).some(u=>{const f=u.start.toDate(),S=u.end.toDate();return u.fahrzeug===t&&(h>=f&&h<S||p>f&&p<=S||h<=f&&p>=S)})}catch(g){return console.error("Fehler beim Prüfen von Konflikten:",g),!1}},tt=async(t,h)=>{try{const p=await ce(ie(q,"vehicles")),g={},r=new Date(`${t.dateStart}T${t.timeStart}`),u=new Date(`${t.dateEnd}T${t.timeEnd}`);for(const f of p.docs){const S=f.data(),k=S.group,o=h[k]||"Sonstige";g[o]||(g[o]=[]);const A=await et(f.id,r,u);g[o].push({id:f.id,...S,isConflicting:A})}return g}catch(p){return console.error("Fehler beim Abrufen und Kategorisieren der Fahrzeuge:",p),{}}},xe=async(t,h,p=!1)=>{const{dateStart:g,timeStart:r,dateEnd:u,timeEnd:f,vehicle:S}=t,k=["A","B","CPKW","DPKW","EPKW"],o=["APK","APG","AK","AP","AAT"],A=["C","D","E","F","G"],j=new Date(`${g}T${r}`),m=new Date(`${u}T${f}`),x=Math.ceil((m-j)/(1e3*60*60)),E=Math.ceil(x/24),I=Object.values(h).flat().find(c=>c.id===S);if(!I)return{preis:0,freiKm:0,type:"Keine Daten verfügbar"};const M=I.group.toUpperCase(),L=p?"pricingGroupsBusiness":"pricingGroupsPrivate";console.log(`
✨ NEUE PREISANFRAGE`),console.log("🚗 Fahrzeug-ID:",S),console.log("🧮 Gruppe:",M),console.log("👤 Kundentyp:",p?"Geschäftlich":"Privat"),console.log("⏱️ Dauer:",x,"Stunden /",E,"Tage");let i=null;try{const c=G(q,L,M),b=await V(c);if(b.exists())i=b.data(),console.log("📦 Geladene Preisdaten:",i);else throw new Error(`Keine Daten für Gruppe ${M}`)}catch(c){return console.error("❌ Fehler beim Laden der Preisdaten:",c),{preis:0,freiKm:0,type:"Keine Preisdaten gefunden"}}const _=c=>c.includes(M);let F=[];const s=(c,b,D,y=null)=>{F.push({preis:b,freiKm:D,type:c,details:y}),console.log(`🔹 ${c}: ${b} € | ${D} km`,y?`| Details: ${y}`:"")};if(_(A)){if(x<=1)s("Stundenbasis-Preis",i.pricePerHour,i.kmPerHour,"1h Basis");else if(x>1&&x<=4){const c=x-1,b=i.pricePerHour+c*i.pricePerExtraHour,D=i.pricePerFiveHours,y=Math.min(b,D),B=y===D?i.kmPerFiveHours:i.kmPerHour+c*i.kmPerExtraHour,z=y===D?"5h Pauschalpreis":`1h Basis + ${c}h Extra`;s("Stundenbasis mit Extra",y,B,z)}if(x===5&&s("5-Stunden-Basis-Preis",i.pricePerFiveHours,i.kmPerFiveHours,"5h Basis"),x>5&&x<24){const c=x-5,b=i.pricePerFiveHours+c*i.pricePerExtraHour,D=i.pricePerDay,y=Math.min(b,D),B=y===D?i.kmPerDay:i.kmPerFiveHours+c*i.kmPerExtraHour,z=y===D?"Tagespreis":`5h Basis + ${c}h Extra`;s("Tagesbasis (5+ Extra)",y,B,z)}if(x===24&&s("Tagesbasis-Preis",i.pricePerDay,i.kmPerDay,"24h Basis"),x>24&&x<168){const c=Math.ceil((x-24)/24),b=i.pricePerDay+c*i.pricePerDay,D=i.pricePerWeek,y=Math.min(b,D),B=y===D?i.kmPerWeek:i.kmPerDay+c*i.kmPerDay,z=y===D?"Wochenpreis":`1 Tag + ${c} zusätzliche Tage`;s("Wochenpreis kombiniert",y,B,z)}if(x===168&&s("Wochenbasis-Preis",i.pricePerWeek,i.kmPerWeek,"7 Tage"),x>168&&x<720){const c=Math.floor((x-168)/168),b=Math.ceil((x-168)%168/24),D=i.pricePerWeek*(1+c)+b*i.pricePerDay,y=i.pricePerMonth,B=Math.min(D,y),z=B===y?i.kmPerMonth:i.kmPerWeek*(1+c)+b*i.kmPerDay,w=B===y?"Monatspreis":`${c+1} Wochen + ${b} Tage`;s("Monatsbasis kombiniert",B,z,w)}if(x>=720){const c=Math.ceil(x/720);s("Monatsbasis-Preis",i.pricePerMonth*c,i.kmPerMonth*c,`${c} Monat(e)`)}}else _(k)?(s("Tagesbasis-Preis",i.pricePerDay*E,i.kmPerDay*E,`${E} Tag(e)`),s("Wochenbasis-Preis",i.pricePerWeek*Math.ceil(E/7),i.kmPerWeek*Math.ceil(E/7),`${Math.ceil(E/7)} Woche(n)`),s("Monatsbasis-Preis",i.pricePerMonth*Math.ceil(E/30),i.kmPerMonth*Math.ceil(E/30),`${Math.ceil(E/30)} Monat(e)`)):_(o)&&(s("5-Stunden-Basis-Preis",i.pricePerFiveHours*Math.ceil(x/5),0,`${Math.ceil(x/5)}x 5h Blocks`),s("24-Stunden-Basis-Preis",i.pricePerDay*Math.ceil(x/24),0,`${Math.ceil(x/24)}x 24h`),s("7-Tage-Basis-Preis",i.pricePerWeek*Math.ceil(E/7),0,`${Math.ceil(E/7)} Woche(n)`),s("30-Tage-Basis-Preis",i.pricePerMonth*Math.ceil(E/30),0,`${Math.ceil(E/30)} Monat(e)`));const n=F.reduce((c,b)=>b.preis<c.preis?b:c,F[0]);return console.log(`
🏁 Beste Option:`,n),{preis:parseFloat(n.preis.toFixed(2)),freiKm:n.freiKm,type:n.type,details:n.details||null}},st={A:"PKW klein",B:"PKW mittel",CPKW:"PKW groß/7-Sitzer",DPKW:"9-Sitzer klein",EPKW:"9-Sitzer groß",C:"Transporter kurz",D:"Transporter lang",E:"Transporter extra lang",F:"LKW 3,5t",G:"LKW 7,5t",APK:"Anhänger Plane klein",APG:"Anhänger Plane groß",AK:"Anhänger Koffer",AP:"Anhänger Pritsche",AAT:"Anhänger Autotrailer"},rt=[{category:"PKW klein",groups:["A"]},{category:"PKW mittel",groups:["B"]},{category:"PKW groß/7-Sitzer",groups:["CPKW"]},{category:"9-Sitzer klein",groups:["DPKW"]},{category:"9-Sitzer groß",groups:["EPKW"]},{category:"Transporter kurz",groups:["C"]},{category:"Transporter lang",groups:["D"]},{category:"Transporter extra lang",groups:["E"]},{category:"LKW 3,5t",groups:["F"]},{category:"LKW 7,5t",groups:["G"]},{category:"Anhänger Plane klein",groups:["APK"]},{category:"Anhänger Plane groß",groups:["APG"]},{category:"Anhänger Koffer",groups:["AK"]},{category:"Anhänger Pritsche",groups:["AP"]},{category:"Anhänger Autotrailer",groups:["AAT"]},{category:"Sonstige",groups:[]}],fe=()=>{const t=new Date,h=t.getFullYear(),p=String(t.getMonth()+1).padStart(2,"0"),g=String(t.getDate()).padStart(2,"0");return`${h}-${p}-${g}`},at=(t,h)=>{const{name:p,value:g}=t.target;h(r=>({...r,[p]:g}))},be=t=>/^\+?[0-9\s\-()]*$/.test(t),nt=async(t,h=!1)=>{if(!t)return[];const p=se(),g=h?"pricingGroupsBusiness":"pricingGroupsPrivate",r=G(p,g,t);try{const u=await V(r);if(u.exists()){const f=u.data();return console.log("Geladene Zusatzoptionen:",f.extraKmPackages),f.extraKmPackages||[]}else return console.warn(`Dokument für ${t} in ${g} nicht gefunden.`),[]}catch(u){return console.error("Fehler beim Abrufen der Zusatzoptionen aus Firestore:",u),[]}};function ye({onSubmit:t,onClose:h,initialData:p,isEdit:g}){const[r,u]=d.useState(p||{kunde:"privat",vehicle:"",name:"",firstName:"",phoneNumber:"",dateStart:fe(),dateEnd:fe(),timeStart:"06:00",timeEnd:"22:00",preis:0,freiKm:0,info:"",extraOption:"",extraKm:0}),[f,S]=d.useState([]),[k,o]=d.useState([]),[A,j]=d.useState({}),[m,x]=d.useState({}),[E,I]=d.useState(0);d.useEffect(()=>{const s=setTimeout(async()=>{const n="vehicles";try{const c=await tt(r,st,n);j(c),x(c)}catch(c){console.error(`Fehler beim Laden der Daten aus der Firestore-Datenbank '${n}':`,c)}},100);return()=>clearTimeout(s)},[r.dateStart,r.timeStart,r.dateEnd,r.timeEnd]),d.useEffect(()=>{(async()=>{if(r.vehicle){const n=F(r.vehicle,A),c=r.kunde==="geschäftlich",b=await nt(n,c);S(b)}else S([])})()},[r.vehicle,A]),d.useEffect(()=>{p&&Object.keys(A).length>0&&(u(p),M(p))},[p,A]);const M=async s=>{if(!s.vehicle)return;const n=s.kunde==="geschäftlich",c=F(s.vehicle,A),b=await xe(s,m,n),D=await L(c,n),y=parseFloat((s.extraKm*D).toFixed(2));let B=`${b.type} - ${b.preis} € (${b.freiKm} km frei)`;if(b.details&&!["5-Stunden-Basis-Preis","Tagesbasis-Preis","Wochenbasis-Preis","Monatsbasis-Preis","24-Stunden-Basis-Preis","7-Tage-Basis-Preis","30-Tage-Basis-Preis"].includes(b.type)&&(B+=`
${b.details}`),s.extraOption)try{const O=JSON.parse(s.extraOption);B+=`
Zusatzoption: ${O.km} km - ${O.price} €`}catch{}s.extraKm>0&&(B+=`
Zusatz-km: ${s.extraKm} km - ${y} €`);const z=b.preis+(s.extraOption?JSON.parse(s.extraOption).price:0)+y,w=b.freiKm+(s.extraOption?JSON.parse(s.extraOption).km:0)+(s.extraKm||0);B+=`
__________________________________________________________________
Gesamtpreis: ${z.toFixed(2)} € / Gesamtkilometer: ${w.toFixed(0)} km`,u(O=>({...O,preis:z,freiKm:b.freiKm,info:B.trim()}))},L=async(s,n=!1)=>{if(!s)return 0;const c=se(),D=G(c,n?"pricingGroupsBusiness":"pricingGroupsPrivate",s.toUpperCase());try{const y=await V(D);if(y.exists())return y.data().extraKmPrice||0}catch(y){console.error("Fehler beim Laden des extraKmPrice:",y)}return 0},i=s=>{s.preventDefault(),t(r),h()},_=s=>{at(s,u)},F=(s,n)=>{for(const c in n)for(const b of n[c])if(b.id===s)return b.group;return null};return e.jsxs("div",{className:"container-flex mt-4",children:[e.jsx("h2",{className:"text-center mb-4",children:g?"Termin bearbeiten":"Termin erstellen"}),e.jsxs("form",{onSubmit:i,children:[e.jsxs("div",{className:"row mb-3",children:[e.jsxs("div",{className:"col-6 mt-3 border-r-2 border-gray-400",children:[e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"kunde",className:"form-label",children:"Kunde"}),e.jsxs("select",{className:"form-select",id:"kunde",name:"kunde",value:r.kunde,onChange:s=>u({...r,kunde:s.target.value}),children:[e.jsx("option",{value:"privat",children:"Privat"}),e.jsx("option",{value:"geschäftlich",children:"Geschäftlich"})]})]})}),e.jsx("div",{className:"col-6",children:e.jsx("button",{className:"btn btn-primary mt-8 ms-4 ",disabled:!0,children:e.jsx("i",{className:"bi bi-person"})})})]}),e.jsxs("div",{className:"row mb-3",children:[e.jsxs("div",{className:"col-6",children:[e.jsx("label",{htmlFor:"firstName",className:"form-label",children:"Vorname"}),e.jsx("input",{type:"text",className:"form-control",id:"firstName",name:"firstName",value:r.firstName,onChange:_,required:!0})]}),e.jsxs("div",{className:"col-6",children:[e.jsx("label",{htmlFor:"name",className:"form-label",children:"Name"}),e.jsx("input",{type:"text",className:"form-control",id:"name",name:"name",value:r.name,onChange:_,required:!0})]})]}),e.jsxs("div",{className:"col-12",children:[e.jsx("label",{htmlFor:"phoneNumber",className:"form-label",children:"Telefonnummer"}),e.jsx("input",{type:"text",className:`form-control ${be(r.phoneNumber)?"":"is-invalid"}`,id:"phoneNumber",name:"phoneNumber",value:r.phoneNumber,onChange:_,required:!0}),!be(r.phoneNumber)&&e.jsx("div",{className:"invalid-feedback",children:"Bitte geben Sie eine gültige Telefonnummer ein."})]}),e.jsx("label",{htmlFor:"info",className:"form-label mt-3",children:"Info"}),e.jsx("textarea",{className:"col-12 border rounded shadow-sm bg-light",id:"info",name:"info",style:{height:100},value:r.info,onChange:s=>u({...r,info:s.target.value}),placeholder:"Zusätzliche Informationen"})]}),e.jsxs("div",{className:"col-6",children:[e.jsxs("div",{className:"row mt-3",children:[e.jsxs("div",{className:"col-6",children:[e.jsx("label",{htmlFor:"dateStart",className:"form-label",children:"Datum Start"}),e.jsx("input",{type:"date",className:"form-control",id:"dateStart",name:"dateStart",value:r.dateStart,onChange:_,required:!0})]}),e.jsxs("div",{className:"col-6",children:[e.jsx("label",{htmlFor:"dateEnd",className:"form-label",children:"Datum Ende"}),e.jsx("input",{type:"date",className:`form-control ${r.dateEnd<r.dateStart?"is-invalid":""}`,id:"dateEnd",name:"dateEnd",value:r.dateEnd,onChange:_,required:!0})]})]}),e.jsxs("div",{className:"row mt-3",children:[e.jsxs("div",{className:"col-6",children:[e.jsx("label",{htmlFor:"timeStart",className:"form-label",children:"Uhrzeit Start"}),e.jsx("input",{type:"time",className:"form-control",id:"timeStart",name:"timeStart",value:r.timeStart,onChange:_,required:!0})]}),e.jsxs("div",{className:"col-6 mb-3",children:[e.jsx("label",{htmlFor:"timeEnd",className:"form-label",children:"Uhrzeit Ende"}),e.jsx("input",{type:"time",className:`form-control ${r.dateEnd+r.timeEnd<r.dateStart+r.timeStart?"is-invalid":""}`,id:"timeEnd",name:"timeEnd",value:r.timeEnd,onChange:_,required:!0})]})]}),e.jsx("label",{htmlFor:"vehicle",className:"form-label",children:"Fahrzeug"}),e.jsxs("select",{className:"form-select",id:"vehicle",name:"vehicle",value:r.vehicle,onChange:async s=>{const n=s.target.value,c=r.kunde==="geschäftlich",b=await xe({...r,vehicle:n},m,c);u(D=>({...D,vehicle:n,preis:b.preis,freiKm:b.freiKm,info:(`${b.type} - ${b.preis} € (${b.freiKm} km frei)`+(b.details&&!["5-Stunden-Basis-Preis","Tagesbasis-Preis","Wochenbasis-Preis","Monatsbasis-Preis","24-Stunden-Basis-Preis","7-Tage-Basis-Preis","30-Tage-Basis-Preis"].includes(b.type)?`
${b.details}`:"")).trim()}))},required:!0,children:[e.jsx("option",{value:"",children:"Fahrzeug wählen..."}),rt.map(({category:s})=>{const n=A[s]||[];return n.length===0?null:e.jsx("optgroup",{label:s,children:n.map(c=>e.jsxs("option",{value:c.id,className:c.isConflicting?"text-danger":"",disabled:c.isConflicting,children:[c.id," ",c.isConflicting?"(belegt)":""]},c.id))},s)})]}),e.jsx("label",{htmlFor:"extraOptions",className:"form-label mt-3",children:"Zusatzoptionen auswählen"}),e.jsxs("select",{className:"form-select",id:"extraOptions",name:"extraOptions",value:r.extraOption||"",onChange:s=>{const n=s.target.value;if(!n){u(b=>{const D=b.info.split(`
`).filter(y=>!y.startsWith("Zusatzoption:")).join(`
`);return{...b,extraOption:"",info:D.trim()}});return}const c=JSON.parse(n);u(b=>{const D=b.info.split(`
`).filter(y=>!y.startsWith("Zusatzoption:")).join(`
`);return{...b,extraOption:n,info:`${D}
Zusatzoption: ${c.km} km - ${c.price} €`.trim()}})},children:[e.jsx("option",{value:"",children:"Zusatzoption wählen..."}),f.map((s,n)=>e.jsx("option",{value:JSON.stringify(s),children:`${s.km} km - ${s.price} €`},n)),r.extraOption&&!f.some(s=>JSON.stringify(s)===r.extraOption)&&e.jsx("option",{value:r.extraOption,children:`${JSON.parse(r.extraOption).km} km - ${JSON.parse(r.extraOption).price} € (nicht verfügbar)`})]}),e.jsx("label",{htmlFor:"extraKm",className:"form-label mt-3",children:"Zusatz-km"}),e.jsx("input",{type:"number",className:"form-control",id:"extraKm",name:"extraKm",min:0,value:r.extraKm||"",onChange:async s=>{const n=parseInt(s.target.value,10)||0,c=r.kunde==="geschäftlich",b=F(r.vehicle,A),D=await L(b,c),y=(n*D).toFixed(2);u(B=>{const z=B.info.split(`
`).filter(w=>!w.startsWith("Zusatz-km:")).join(`
`);return{...B,extraKm:n,info:n>0?`${z}
Zusatz-km: ${n} km - ${y} €`.trim():z.trim()}})}}),r.extraKm>0&&e.jsxs("small",{className:"text-muted d-block",children:["Preis pro km aktuell: ",E.toFixed(2)," €"]})]})]}),e.jsx("button",{type:"submit",className:"btn btn-primary mt-4",disabled:r.dateEnd+r.timeEnd<r.dateStart+r.timeStart,children:g?"Speichern":"Erstellen"})]})]})}const it=()=>{const[t,h]=d.useState([]),[p,g]=d.useState(null),[r,u]=d.useState(!1);d.useEffect(()=>{(async()=>{try{const o=ie(q,"events"),j=(await ce(o)).docs.map(m=>({id:m.id,...m.data()}));h(j)}catch(o){console.error("Fehler beim Abrufen von Events:",o)}})()},[]);const f=async k=>{try{const o=await V(G(q,"events",k));return o.exists()?{id:o.id,...o.data()}:(console.error("Event nicht gefunden"),null)}catch(o){return console.error("Fehler beim Abrufen der Eventdetails:",o),null}},S=async k=>{const o=await f(k);g(o),u(!0)};return e.jsxs("div",{children:[e.jsx("h1",{children:"Events"}),e.jsx("ul",{children:t.map(k=>e.jsxs("li",{onClick:()=>S(k.id),children:[e.jsx("h2",{children:k.title}),e.jsx("p",{children:k.kunde}),e.jsx("p",{children:k.vorname}),e.jsx("p",{children:k.nachname}),e.jsx("p",{children:k.telNr}),e.jsxs("p",{children:["von:"," ",new Date(k.start.toDate()).toLocaleString("de-DE",{day:"2-digit",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"})]}),e.jsxs("p",{children:["bis:"," ",new Date(k.end.toDate()).toLocaleString("de-DE",{day:"2-digit",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"})]}),e.jsx("p",{children:k.fahrzeug}),e.jsx("div",{className:"col-6",children:e.jsxs("p",{children:[k.preis,"€/",k.km,"km"]})})]},k.id))}),r&&e.jsx(lt,{selectedEvent:p,setIsEventModalOpen:u})]})},lt=({selectedEvent:t,setIsEventModalOpen:h})=>{const p=le();if(!t)return null;const g=()=>{p(`/edit-event/${t.id}`,{state:{eventData:t}}),h(!1)};return e.jsxs("div",{className:"modal-content bg-white p-4 rounded-lg shadow-lg",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4 text-center",children:"Event Details"}),e.jsxs("p",{children:[e.jsx("strong",{children:"Title:"})," ",t.title]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Kunde:"})," ",t.kunde]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Vorname:"})," ",t.vorname]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Nachname:"})," ",t.nachname]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Telefonnummer:"})," ",t.telNr]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Von:"})," ",new Date(t.start.toDate()).toLocaleString("de-DE",{day:"2-digit",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Bis:"})," ",new Date(t.end.toDate()).toLocaleString("de-DE",{day:"2-digit",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Fahrzeug:"})," ",t.fahrzeug]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Preis:"})," ",t.preis,"€ / ",t.km,"km"]}),e.jsx("button",{className:"btn btn-secondary mt-4",onClick:()=>h(!1),children:"Schließen"}),e.jsxs("button",{className:"btn btn-primary mt-2 ms-2",onClick:g,children:[e.jsx("i",{className:"bi bi-pencil"})," Bearbeiten"]})]})},ot=({events:t,onUpdate:h,fetchEventDetails:p})=>{const[g,r]=d.useState(t),[u,f]=d.useState(null),[S,k]=d.useState(!1),o=le(),A=async m=>{try{await Ae(G(q,"events",m)),alert("Termin erfolgreich gelöscht!");const x=g.filter(E=>E.id!==m);r(x),h()}catch(x){console.error("Fehler beim Löschen des Termins:",x),alert("Fehler beim Löschen des Termins.")}},j=async m=>{try{const x=await p(m.id);x&&(f(x),k(!0))}catch(x){console.error("Fehler beim Abrufen der Eventdetails:",x)}};return e.jsxs("div",{className:"modal-content bg-white p-4 rounded-lg shadow-lg",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4 text-center",children:"Termine"}),g&&g.length>0?e.jsx("ul",{className:"list-group",children:g.map((m,x)=>{var E,I,M,L;return e.jsx("li",{className:"list-group-item mb-3 border rounded-lg p-3 shadow-sm hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"row mb-2",children:[e.jsxs("div",{className:"col-3",children:[e.jsx("strong",{className:"text-lg font-semibold",children:m.title}),e.jsx("br",{})]}),e.jsxs("div",{className:"col-3",children:[e.jsxs("span",{className:"text-sm text-gray-500",children:["Datum: ",(E=m.start)==null?void 0:E.toLocaleDateString()," -"," ",(I=m.end)==null?void 0:I.toLocaleDateString()]}),e.jsx("br",{}),e.jsxs("span",{className:"text-sm text-gray-500",children:["Zeit: ",(M=m.start)==null?void 0:M.toLocaleTimeString()," -"," ",(L=m.end)==null?void 0:L.toLocaleTimeString()]}),e.jsx("br",{})]}),e.jsx("div",{className:"col-3",children:e.jsxs("span",{className:"text-s text-black-500",children:["Info: ",m.description||"Keine Info verfügbar"]})}),e.jsxs("div",{className:"col-3 text-end",children:[e.jsx("button",{className:"btn btn-danger btn-sm",onClick:()=>A(m.id),children:e.jsx("i",{className:"bi bi-trash"})}),e.jsx("button",{className:"btn btn-primary btn-sm",onClick:()=>o(`/edit-event/${m.id}`,{state:{eventData:m}}),children:e.jsx("i",{className:"bi bi-pencil"})}),e.jsx("button",{className:"btn btn-secondary btn-sm ",disabled:!0,onClick:()=>{j(m)},children:e.jsx("i",{className:"bi bi-eye"})}),e.jsx("button",{className:"btn btn-success btn-sm",onClick:()=>o("/vertrag",{state:{uid:m.id,eventData:m}}),children:e.jsx("i",{className:"bi bi-currency-euro"})})]})]})},x)})}):e.jsx("p",{className:"text-center text-gray-500",children:"Keine Termine vorhanden."})]})};Ue("de",he);const ct=Re(de);oe.setAppElement("#root");const dt=({date:t,onDateChange:h,onNewEvent:p})=>{const[g,r]=d.useState(!1),u=o=>{h(o),r(!1)},f=()=>{const o=de(t).subtract(1,"month").toDate();h(o)},S=()=>{const o=de(t).add(1,"month").toDate();h(o)},k=()=>{h(new Date)};return e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"10px"},children:[e.jsx("button",{onClick:f,className:"btn btn-light",children:e.jsx("i",{className:"bi bi-arrow-left nav"})}),e.jsxs("div",{style:{textAlign:"center",position:"relative",flexGrow:1},children:[e.jsx("div",{className:"btn btn-light",children:e.jsx("h3",{onClick:k,onDoubleClick:o=>{o.stopPropagation(),r(!0)},style:{margin:0,cursor:"pointer"},children:Ne(t,"LLLL yyyy",{locale:he})})}),g&&e.jsxs("div",{style:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",zIndex:1e3,padding:"30px",borderRadius:"8px",backgroundColor:"white",boxShadow:"0 8px 10px rgba(0, 0, 0, 0.41)",width:"800px",height:"600px"},children:[e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx("button",{onClick:()=>r(!1),style:{background:"none",border:"none",fontSize:"34px",cursor:"pointer"},children:"×"})}),e.jsx(Ge,{selected:t,onChange:u,showMonthYearPicker:!0,inline:!0,locale:"de",dateFormat:"LLLL yyyy"})]})]}),e.jsx("button",{onClick:p,className:"btn btn-light fs-3",children:e.jsx("i",{className:"bi bi-calendar-plus"})}),e.jsx("button",{onClick:S,className:"btn btn-light",children:e.jsx("i",{className:"bi bi-arrow-right nav"})})]})},mt=()=>{const[t,h]=d.useState([]),p=async()=>{const w=ie(q,"events"),W=(await ce(w)).docs.map(H=>{var Q,X;const U=H.data(),ae=(Q=U.start)==null?void 0:Q.toDate(),te=(X=U.end)==null?void 0:X.toDate();return{id:H.id,title:U.title,start:ae,end:te,kunde:U.kunde,fahrzeug:U.fahrzeug,preis:U.preis,km:U.km,telNr:U.telNr,description:U.description,abgerechnet:U.abgerechnet}});h(W.filter(H=>H!==null))};d.useEffect(()=>{p()},[]);const[g,r]=d.useState(new Date),[u,f]=d.useState(!1),[S,k]=d.useState(!1),[o,A]=d.useState(!1),[j,m]=d.useState(null),[x,E]=d.useState(null),[I,M]=d.useState(null),[L,i]=d.useState([]),_=()=>u||S||o,F=async w=>{const O=G(q,"events",w),W=await V(O);return W.exists()?{id:W.id,...W.data()}:(console.error("Kein Dokument mit dieser ID gefunden:",w),null)},s=()=>{f(!0)},n=()=>{f(!1),p()},c=()=>{k(!1),m(null)},b=async w=>{try{await Te(ie(q,"events"),{title:`${w.name} / ${w.vehicle}`,start:new Date(`${w.dateStart}T${w.timeStart}`),end:new Date(`${w.dateEnd}T${w.timeEnd}`),name:w.name,vorname:w.firstName,kunde:w.kunde,fahrzeug:w.vehicle,preis:w.preis,km:w.freiKm,telNr:w.phoneNumber||null,description:w.info||null,abgerechnet:!1}),console.log("Event erfolgreich erstellt!")}catch(O){console.error("Fehler beim Erstellen des Events:",O)}};let D;const y=({start:w,end:O})=>{_()||(i(t.filter(W=>W.start<=O&&W.end>=w)),A(!0),D?(clearTimeout(D),D=null,B({start:w,end:O})):D=setTimeout(()=>{console.log("Einfacher Klick auf den Tag erkannt"),i(t.filter(W=>W.start<=O&&W.end>=w)),A(!0),D=null},300))},B=({start:w,end:O})=>{console.log("Doppelklick auf den Tag erkannt"),A(!1),k(!1),E(w),M(O),f(!0)},z=w=>{t.filter(W=>W.start>=w.start&&W.end<=w.end).length>10&&A(!0)};return d.useEffect(()=>{},[u,S,o]),e.jsxs("div",{style:{height:"80vh",margin:"5px",width:"90vw"},children:[e.jsx(We,{localizer:ct,date:g,onNavigate:w=>r(w),events:t,startAccessor:"start",endAccessor:"end",selectable:!0,views:["day","week","month"],onSelectSlot:y,onDoubleClickEvent:B,onSelectEvent:y,onRangeChange:z,onShowMore:(w,O)=>{i(w),A(!0)},components:{toolbar:w=>e.jsx(dt,{...w,date:g,onDateChange:r,onNewEvent:s})},formats:{weekdayFormat:w=>Ne(w,"EEEE",{locale:he})},style:{height:"100%"}}),e.jsxs(oe,{isOpen:u,onRequestClose:n,style:{overlay:{zIndex:10,backgroundColor:"rgba(0, 0, 0, 0.5)"},content:{top:"50%",left:"50%",right:"auto",bottom:"auto",marginRight:"-50%",transform:"translate(-50%, -50%)",padding:"20px",borderRadius:"10px",width:"75vw",height:"auto",boxShadow:"0 4px 8px rgba(0, 0, 0, 0.2)",backgroundColor:"white"}},children:[u,e.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:"-20px",marginRight:"-20px"},children:e.jsx("button",{onClick:n,style:{backgroundColor:"red",width:"40px",height:"40px",color:"white",border:"none",fontSize:"28px",cursor:"pointer",display:"flex",justifyContent:"center",alignItems:"center"},children:"×"})}),e.jsx(ye,{initialStartDate:x,initialEndDate:I,onSubmit:b,onClose:n})]}),e.jsxs(oe,{isOpen:S,onRequestClose:c,style:{overlay:{zIndex:11,backgroundColor:"rgba(0, 0, 0, 0.5)"},content:{zIndex:1e3,top:"50%",left:"50%",right:"auto",bottom:"auto",marginRight:"-50%",transform:"translate(-50%, -50%)",padding:"20px",borderRadius:"10px",width:"60vw",boxShadow:"0 4px 8px rgba(0, 0, 0, 0.2)",backgroundColor:"white"}},children:[S,e.jsx(it,{event:j,onClose:c})]}),e.jsx(oe,{isOpen:o,onRequestClose:()=>{A(!1),p()},style:{overlay:{zIndex:10,backgroundColor:"rgba(0, 0, 0, 0.5)"},content:{top:"50%",left:"50%",right:"auto",bottom:"auto",marginRight:"-50%",transform:"translate(-50%, -50%)",padding:"20px",borderRadius:"10px",width:"90vw",height:"auto",boxShadow:"0 4px 8px rgba(0, 0, 0, 0.2)",backgroundColor:"white"}},children:e.jsx(ot,{events:L,onClose:()=>{A(!1),p()},onUpdate:p,isEventModalOpen:S,setIsEventModalOpen:k,fetchEventDetails:F,setSelectedEvent:m,setIsModalOpen:f,setIsDayEventsModalOpen:A})})]})};function ut(){return e.jsxs("div",{children:[e.jsx(mt,{})," "]})}const ht=()=>{const[t,h]=d.useState(null),[p,g]=d.useState(!0);return d.useEffect(()=>{(async()=>{try{const u=re.currentUser;if(u){const f=G(q,"users",u.uid),S=await V(f);S.exists()?h(S.data()):console.error("Benutzerdaten nicht gefunden")}else console.error("Kein Benutzer angemeldet")}catch(u){console.error("Fehler beim Laden der Benutzerdaten:",u)}finally{g(!1)}})()},[]),p?e.jsx("p",{className:"text-center mt-5",children:"Lade Benutzerdaten..."}):t?e.jsx("div",{className:"container mt-5",children:e.jsxs("div",{className:"card shadow-lg",children:[e.jsx("div",{className:"card-header bg-primary text-white text-center",children:e.jsx("h2",{children:t.name||"Unbekannter Benutzer"})}),e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-md-3 text-center",children:e.jsx("img",{src:t.profilePicture||"https://placehold.co/150",alt:"Profilbild",className:"img-fluid rounded-circle mb-3",style:{width:"150px",height:"150px",objectFit:"cover",margin:"0 auto"}})}),e.jsxs("div",{className:"col-md-8",children:[e.jsx("h4",{className:"card-title"}),e.jsxs("p",{className:"card-text",children:[e.jsx("strong",{children:"Email:"})," ",t.email||"Keine Email angegeben"]}),e.jsxs("p",{className:"card-text",children:[e.jsx("strong",{children:"Telefon:"})," ",t.phone||"Keine Telefonnummer angegeben"]}),e.jsxs("p",{className:"card-text",children:[e.jsx("strong",{children:"Adresse:"})," ",t.station||"Keine Adresse angegeben"]}),e.jsx("button",{className:"btn btn-primary mt-3",children:e.jsx(ne,{to:"/Profiledit",className:"text-white text-decoration-none",children:"Profil bearbeiten"})})]})]})})]})}):e.jsx("p",{className:"text-center mt-5",children:"Benutzerdaten konnten nicht geladen werden."})},pt=()=>{const[t,h]=d.useState({}),[p,g]=d.useState(!0),[r,u]=d.useState(""),f={uid:"Benutzer-ID",email:"E-Mail",role:"Rolle",displayName:"Anzeigename",createdAt:"Erstellt am",phoneNumber:"Telefonnummer",birthday:"Geburtstag","address.stadt":"Stadt","address.strasse":"Straße","address.hausnummer":"Hausnummer","address.plz":"Postleitzahl"};d.useEffect(()=>{(async()=>{try{const m=re.currentUser;if(m){const x=G(q,"users",m.uid),E=await V(x);E.exists()?h(E.data()):console.error("Benutzerdaten nicht gefunden")}else console.error("Kein Benutzer angemeldet")}catch(m){console.error("Fehler beim Laden der Benutzerdaten:",m)}finally{g(!1)}})()},[]);const S=j=>{const{name:m,value:x}=j.target;if(m.includes(".")){const[E,I]=m.split(".");h({...t,[E]:{...t[E],[I]:x}})}else h({...t,[m]:x})},k=async j=>{j.preventDefault();try{const m=re.currentUser;if(m){const x=G(q,"users",m.uid);await Ke(x,t),u("Profil erfolgreich aktualisiert!")}}catch(m){console.error("Fehler beim Aktualisieren des Profils:",m)}};if(p)return e.jsx("p",{className:"text-center mt-5",children:"Lade Benutzerdaten..."});const o=["uid","email","role","displayName","createdAt"],A=["phoneNumber","birthday","address.stadt","address.strasse","address.hausnummer","address.plz"];return e.jsxs("div",{className:"app-wrapper bg-light min-h-screen flex flex-col items-center justify-center",style:{overflowY:"auto",paddingTop:"20%",paddingBottom:"10%",paddingLeft:"10%",paddingRight:"10%"},children:[e.jsx("div",{className:"container ",style:{height:"800px",margin:"0 auto"}}),e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Profil bearbeiten"}),e.jsx("p",{className:"text-gray-600",children:"Hier können Sie Ihre Profilinformationen bearbeiten."}),e.jsxs("div",{className:"card shadow-lg w-100",children:[e.jsx("div",{className:"card-header bg-primary text-white text-center",style:{padding:"15px"},children:e.jsx("h2",{className:"text-xl font-bold",children:"Profil bearbeiten"})}),e.jsxs("div",{className:"card-body",children:[r&&e.jsx("div",{className:"alert alert-success",role:"alert",children:r}),e.jsxs("form",{onSubmit:k,children:[e.jsx("h4",{className:"text-lg font-semibold mb-3",children:"Login-Felder"}),e.jsx("div",{className:"row",children:o.map(j=>e.jsxs("div",{className:"col-md-6 mb-3",children:[e.jsx("label",{className:"form-label",children:f[j]}),e.jsx("input",{type:"text",className:"form-control border-gray-300 shadow-sm focus:ring focus:ring-blue-300",name:j,value:t[j]||"",onChange:S,disabled:j==="uid"||j==="createdAt"||j==="role"||j==="email"})]},j))}),e.jsx("h4",{className:"text-lg font-semibold mb-3",children:"Erweiterte Profilfelder"}),e.jsx("div",{className:"row",children:A.map(j=>{var m;return e.jsxs("div",{className:"col-md-6 mb-3",children:[e.jsx("label",{className:"form-label",children:f[j]}),e.jsx("input",{type:"text",className:"form-control border-gray-300 shadow-sm focus:ring focus:ring-blue-300",name:j,value:j.includes(".")?((m=t[j.split(".")[0]])==null?void 0:m[j.split(".")[1]])||"":t[j]||"",onChange:S})]},j)})}),e.jsx("div",{className:"text-center",children:e.jsx("button",{type:"submit",className:"btn btn-success px-5 py-2 mt-3 shadow-md hover:bg-green-600",children:"Speichern"})})]})]})]})]})]})};function gt(){const{id:t}=Le(),h=le(),[p,g]=d.useState(null),[r,u]=d.useState(!0),[f,S]=d.useState(!1);d.useEffect(()=>{const o=me(),A=ue(o,async j=>{if(!j){h("/");return}const m=se(),x=G(m,"users",j.uid);if(!(await V(x)).exists()){console.error("Benutzerdokument nicht gefunden."),h("/unauthorized");return}try{const I=G(m,"events",t),M=await V(I);if(!M.exists()){console.error("Event nicht gefunden"),h("/user-dashboard");return}const L=M.data(),i=L.start.toDate(),_=L.end.toDate(),F=c=>c.toISOString().split("T")[0],s=c=>c.toLocaleTimeString("de-DE",{hour:"2-digit",minute:"2-digit",hour12:!1}),n={name:L.name||"",firstName:L.vorname||"",phoneNumber:L.telNr||"",vehicle:L.fahrzeug||"",dateStart:F(i),timeStart:s(i),dateEnd:F(_),timeEnd:s(_),kunde:L.kunde||"privat",info:L.description||"",preis:L.preis||0,freiKm:L.km||0,extraOption:"",extraKm:0};g(n)}catch(I){console.error("Fehler beim Laden des Events:",I)}u(!1),S(!0)});return()=>A()},[t,h]);const k=async o=>{const A=se(),j=G(A,"events",t);try{const m={title:`${o.firstName} ${o.name} / ${o.vehicle}`,start:new Date(`${o.dateStart}T${o.timeStart}`),end:new Date(`${o.dateEnd}T${o.timeEnd}`),fahrzeug:o.vehicle,name:o.name,vorname:o.firstName,telNr:o.phoneNumber,kunde:o.kunde,preis:o.preis,km:o.freiKm+(o.extraKm||0),description:o.info,abgerechnet:!1};await je(j,m,{merge:!0}),h("/user-dashboard")}catch(m){console.error("Fehler beim Speichern:",m)}};return f?r?e.jsx("p",{className:"container mt-5",children:"Event wird geladen..."}):e.jsx("div",{className:"container mt-5",children:e.jsx(ye,{initialData:p,onSubmit:k,onClose:()=>h(-1),isEdit:!0})}):e.jsx("p",{className:"container mt-5",children:"Authentifizierung wird geprüft..."})}function xt(){const[t,h]=d.useState(null),[p,g]=d.useState("");return d.useEffect(()=>{const r=me(),u=ue(r,async f=>{if(f){h(!0);const S=se(),k=G(S,"users",f.uid),o=await V(k);o.exists()?g(o.data().role||""):g("")}else h(!1),g("")});return()=>u()},[]),e.jsx("div",{className:"app-wrapper",children:e.jsxs(Ie,{basename:"/organizer",children:[e.jsxs("header",{className:"app-header bg-primary text-white text-center d-flex align-items-center justify-content-center",children:[e.jsx("h1",{className:"fs-3 mb-0 ",children:"Verwaltungstool-Autovermietung"}),t&&p==="user"&&e.jsx(Ze,{role:p,className:"nav-user"})]}),e.jsx("main",{className:"app-main bg-light align-items-center",children:e.jsxs(Me,{children:[e.jsx(J,{path:"/",element:e.jsx(Ve,{})}),t===null?e.jsx(J,{path:"*",element:e.jsx("p",{children:"Authentifizierung wird geprüft..."})}):t?e.jsxs(e.Fragment,{children:[e.jsx(J,{path:"/edit-event/:id",element:e.jsx(gt,{})}),e.jsx(J,{path:"/vertrag",element:e.jsx(Xe,{})}),e.jsx(J,{path:"/profil",element:e.jsx(ht,{})}),e.jsx(J,{path:"/profiledit",element:e.jsx(pt,{})}),p==="admin"&&e.jsx(J,{path:"/dashboards/admin-dashboard",element:e.jsx(Ye,{})}),p==="editor"&&e.jsx(J,{path:"/editor-dashboard",element:e.jsx(Qe,{})}),p==="user"&&e.jsx(J,{path:"/user-dashboard",element:e.jsx(ut,{})})]}):e.jsx(J,{path:"*",element:e.jsx(Be,{to:"/"})})]})}),e.jsxs("footer",{className:"app-footer bg-dark text-white",children:[e.jsx("p",{className:"mb-0 small font-monospace"}),e.jsx("p",{className:"mb-0 small font-monospace text-center",children:"© 2025 A.Schurer. Alle Rechte vorbehalten."}),e.jsx("p",{className:"mb-0 small font-monospace text-end",children:"Version 0.0.1-alpha.1"})]})]})})}Ee.createRoot(document.getElementById("root")).render(e.jsx(d.StrictMode,{children:e.jsx(xt,{})}));
