/*!
 * Signature Pad v2.3.2
 * https://github.com/szimek/signature_pad
 *
 * Copyright 2017 Szymon Nowak
 * Released under the MIT license
 *
 * The main idea and some parts of the code (e.g. drawing variable width Bézier curve) are taken from:
 * http://corner.squareup.com/2012/07/smoother-signatures.html
 *
 * Implementation of interpolation using cubic Bézier curves is taken from:
 * http://benknowscode.wordpress.com/2012/09/14/path-interpolation-using-cubic-bezier-and-control-point-estimation-in-javascript
 *
 * Algorithm for approximated length of a Bézier curve is taken from:
 * http://www.lemoda.net/maths/bezier-length/index.html
 *
 */function y(t,i,e){this.x=t,this.y=i,this.time=e||new Date().getTime()}y.prototype.velocityFrom=function(t){return this.time!==t.time?this.distanceTo(t)/(this.time-t.time):1};y.prototype.distanceTo=function(t){return Math.sqrt(Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2))};y.prototype.equals=function(t){return this.x===t.x&&this.y===t.y&&this.time===t.time};function M(t,i,e,o){this.startPoint=t,this.control1=i,this.control2=e,this.endPoint=o}M.prototype.length=function(){for(var t=10,i=0,e=void 0,o=void 0,n=0;n<=t;n+=1){var a=n/t,r=this._point(a,this.startPoint.x,this.control1.x,this.control2.x,this.endPoint.x),s=this._point(a,this.startPoint.y,this.control1.y,this.control2.y,this.endPoint.y);if(n>0){var h=r-e,d=s-o;i+=Math.sqrt(h*h+d*d)}e=r,o=s}return i};M.prototype._point=function(t,i,e,o,n){return i*(1-t)*(1-t)*(1-t)+3*e*(1-t)*(1-t)*t+3*o*(1-t)*t*t+n*t*t*t};function D(t,i,e){var o,n,a,r=null,s=0;e||(e={});var h=function(){s=e.leading===!1?0:Date.now(),r=null,a=t.apply(o,n),r||(o=n=null)};return function(){var d=Date.now();!s&&e.leading===!1&&(s=d);var c=i-(d-s);return o=this,n=arguments,c<=0||c>i?(r&&(clearTimeout(r),r=null),s=d,a=t.apply(o,n),r||(o=n=null)):!r&&e.trailing!==!1&&(r=setTimeout(h,c)),a}}function l(t,i){var e=this,o=i||{};this.velocityFilterWeight=o.velocityFilterWeight||.7,this.minWidth=o.minWidth||.5,this.maxWidth=o.maxWidth||2.5,this.throttle="throttle"in o?o.throttle:16,this.minDistance="minDistance"in o?o.minDistance:5,this.throttle?this._strokeMoveUpdate=D(l.prototype._strokeUpdate,this.throttle):this._strokeMoveUpdate=l.prototype._strokeUpdate,this.dotSize=o.dotSize||function(){return(this.minWidth+this.maxWidth)/2},this.penColor=o.penColor||"black",this.backgroundColor=o.backgroundColor||"rgba(0,0,0,0)",this.onBegin=o.onBegin,this.onEnd=o.onEnd,this._canvas=t,this._ctx=t.getContext("2d"),this.clear(),this._handleMouseDown=function(n){n.which===1&&(e._mouseButtonDown=!0,e._strokeBegin(n))},this._handleMouseMove=function(n){e._mouseButtonDown&&e._strokeMoveUpdate(n)},this._handleMouseUp=function(n){n.which===1&&e._mouseButtonDown&&(e._mouseButtonDown=!1,e._strokeEnd(n))},this._handleTouchStart=function(n){if(n.targetTouches.length===1){var a=n.changedTouches[0];e._strokeBegin(a)}},this._handleTouchMove=function(n){n.preventDefault();var a=n.targetTouches[0];e._strokeMoveUpdate(a)},this._handleTouchEnd=function(n){var a=n.target===e._canvas;a&&(n.preventDefault(),e._strokeEnd(n))},this.on()}l.prototype.clear=function(){var t=this._ctx,i=this._canvas;t.fillStyle=this.backgroundColor,t.clearRect(0,0,i.width,i.height),t.fillRect(0,0,i.width,i.height),this._data=[],this._reset(),this._isEmpty=!0};l.prototype.fromDataURL=function(t){var i=this,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=new Image,n=e.ratio||window.devicePixelRatio||1,a=e.width||this._canvas.width/n,r=e.height||this._canvas.height/n;this._reset(),o.src=t,o.onload=function(){i._ctx.drawImage(o,0,0,a,r)},this._isEmpty=!1};l.prototype.toDataURL=function(t){var i;switch(t){case"image/svg+xml":return this._toSVG();default:for(var e=arguments.length,o=Array(e>1?e-1:0),n=1;n<e;n++)o[n-1]=arguments[n];return(i=this._canvas).toDataURL.apply(i,[t].concat(o))}};l.prototype.on=function(){this._handleMouseEvents(),this._handleTouchEvents()};l.prototype.off=function(){this._canvas.removeEventListener("mousedown",this._handleMouseDown),this._canvas.removeEventListener("mousemove",this._handleMouseMove),document.removeEventListener("mouseup",this._handleMouseUp),this._canvas.removeEventListener("touchstart",this._handleTouchStart),this._canvas.removeEventListener("touchmove",this._handleTouchMove),this._canvas.removeEventListener("touchend",this._handleTouchEnd)};l.prototype.isEmpty=function(){return this._isEmpty};l.prototype._strokeBegin=function(t){this._data.push([]),this._reset(),this._strokeUpdate(t),typeof this.onBegin=="function"&&this.onBegin(t)};l.prototype._strokeUpdate=function(t){var i=t.clientX,e=t.clientY,o=this._createPoint(i,e),n=this._data[this._data.length-1],a=n&&n[n.length-1],r=a&&o.distanceTo(a)<this.minDistance;if(!(a&&r)){var s=this._addPoint(o),h=s.curve,d=s.widths;h&&d&&this._drawCurve(h,d.start,d.end),this._data[this._data.length-1].push({x:o.x,y:o.y,time:o.time,color:this.penColor})}};l.prototype._strokeEnd=function(t){var i=this.points.length>2,e=this.points[0];if(!i&&e&&this._drawDot(e),e){var o=this._data[this._data.length-1],n=o[o.length-1];e.equals(n)||o.push({x:e.x,y:e.y,time:e.time,color:this.penColor})}typeof this.onEnd=="function"&&this.onEnd(t)};l.prototype._handleMouseEvents=function(){this._mouseButtonDown=!1,this._canvas.addEventListener("mousedown",this._handleMouseDown),this._canvas.addEventListener("mousemove",this._handleMouseMove),document.addEventListener("mouseup",this._handleMouseUp)};l.prototype._handleTouchEvents=function(){this._canvas.style.msTouchAction="none",this._canvas.style.touchAction="none",this._canvas.addEventListener("touchstart",this._handleTouchStart),this._canvas.addEventListener("touchmove",this._handleTouchMove),this._canvas.addEventListener("touchend",this._handleTouchEnd)};l.prototype._reset=function(){this.points=[],this._lastVelocity=0,this._lastWidth=(this.minWidth+this.maxWidth)/2,this._ctx.fillStyle=this.penColor};l.prototype._createPoint=function(t,i,e){var o=this._canvas.getBoundingClientRect();return new y(t-o.left,i-o.top,e||new Date().getTime())};l.prototype._addPoint=function(t){var i=this.points,e=void 0;if(i.push(t),i.length>2){i.length===3&&i.unshift(i[0]),e=this._calculateCurveControlPoints(i[0],i[1],i[2]);var o=e.c2;e=this._calculateCurveControlPoints(i[1],i[2],i[3]);var n=e.c1,a=new M(i[1],o,n,i[2]),r=this._calculateCurveWidths(a);return i.shift(),{curve:a,widths:r}}return{}};l.prototype._calculateCurveControlPoints=function(t,i,e){var o=t.x-i.x,n=t.y-i.y,a=i.x-e.x,r=i.y-e.y,s={x:(t.x+i.x)/2,y:(t.y+i.y)/2},h={x:(i.x+e.x)/2,y:(i.y+e.y)/2},d=Math.sqrt(o*o+n*n),c=Math.sqrt(a*a+r*r),u=s.x-h.x,_=s.y-h.y,f=c/(d+c),p={x:h.x+u*f,y:h.y+_*f},x=i.x-p.x,w=i.y-p.y;return{c1:new y(s.x+x,s.y+w),c2:new y(h.x+x,h.y+w)}};l.prototype._calculateCurveWidths=function(t){var i=t.startPoint,e=t.endPoint,o={start:null,end:null},n=this.velocityFilterWeight*e.velocityFrom(i)+(1-this.velocityFilterWeight)*this._lastVelocity,a=this._strokeWidth(n);return o.start=this._lastWidth,o.end=a,this._lastVelocity=n,this._lastWidth=a,o};l.prototype._strokeWidth=function(t){return Math.max(this.maxWidth/(t+1),this.minWidth)};l.prototype._drawPoint=function(t,i,e){var o=this._ctx;o.moveTo(t,i),o.arc(t,i,e,0,2*Math.PI,!1),this._isEmpty=!1};l.prototype._drawCurve=function(t,i,e){var o=this._ctx,n=e-i,a=Math.floor(t.length());o.beginPath();for(var r=0;r<a;r+=1){var s=r/a,h=s*s,d=h*s,c=1-s,u=c*c,_=u*c,f=_*t.startPoint.x;f+=3*u*s*t.control1.x,f+=3*c*h*t.control2.x,f+=d*t.endPoint.x;var p=_*t.startPoint.y;p+=3*u*s*t.control1.y,p+=3*c*h*t.control2.y,p+=d*t.endPoint.y;var x=i+d*n;this._drawPoint(f,p,x)}o.closePath(),o.fill()};l.prototype._drawDot=function(t){var i=this._ctx,e=typeof this.dotSize=="function"?this.dotSize():this.dotSize;i.beginPath(),this._drawPoint(t.x,t.y,e),i.closePath(),i.fill()};l.prototype._fromData=function(t,i,e){for(var o=0;o<t.length;o+=1){var n=t[o];if(n.length>1)for(var a=0;a<n.length;a+=1){var r=n[a],s=new y(r.x,r.y,r.time),h=r.color;if(a===0)this.penColor=h,this._reset(),this._addPoint(s);else if(a!==n.length-1){var d=this._addPoint(s),c=d.curve,u=d.widths;c&&u&&i(c,u,h)}}else{this._reset();var _=n[0];e(_)}}};l.prototype._toSVG=function(){var t=this,i=this._data,e=this._canvas,o=Math.max(window.devicePixelRatio||1,1),n=0,a=0,r=e.width/o,s=e.height/o,h=document.createElementNS("http://www.w3.org/2000/svg","svg");h.setAttributeNS(null,"width",e.width),h.setAttributeNS(null,"height",e.height),this._fromData(i,function(v,m,E){var g=document.createElement("path");if(!isNaN(v.control1.x)&&!isNaN(v.control1.y)&&!isNaN(v.control2.x)&&!isNaN(v.control2.y)){var P="M "+v.startPoint.x.toFixed(3)+","+v.startPoint.y.toFixed(3)+" "+("C "+v.control1.x.toFixed(3)+","+v.control1.y.toFixed(3)+" ")+(v.control2.x.toFixed(3)+","+v.control2.y.toFixed(3)+" ")+(v.endPoint.x.toFixed(3)+","+v.endPoint.y.toFixed(3));g.setAttribute("d",P),g.setAttribute("stroke-width",(m.end*2.25).toFixed(3)),g.setAttribute("stroke",E),g.setAttribute("fill","none"),g.setAttribute("stroke-linecap","round"),h.appendChild(g)}},function(v){var m=document.createElement("circle"),E=typeof t.dotSize=="function"?t.dotSize():t.dotSize;m.setAttribute("r",E),m.setAttribute("cx",v.x),m.setAttribute("cy",v.y),m.setAttribute("fill",v.color),h.appendChild(m)});var d="data:image/svg+xml;base64,",c='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"'+(' viewBox="'+n+" "+a+" "+r+" "+s+'"')+(' width="'+r+'"')+(' height="'+s+'"')+">",u=h.innerHTML;if(u===void 0){var _=document.createElement("dummy"),f=h.childNodes;_.innerHTML="";for(var p=0;p<f.length;p+=1)_.appendChild(f[p].cloneNode(!0));u=_.innerHTML}var x="</svg>",w=c+u+x;return d+btoa(w)};l.prototype.fromData=function(t){var i=this;this.clear(),this._fromData(t,function(e,o){return i._drawCurve(e,o.start,o.end)},function(e){return i._drawDot(e)}),this._data=t};l.prototype.toData=function(){return this._data};export{l as S};
